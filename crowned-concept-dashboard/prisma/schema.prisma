generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model banners {
  id         Int      @id @default(autoincrement())
  title      String   @db.VarChar(255)
  image_url  String?  @db.LongText
  link_url   String?  @db.VarChar(1024)
  is_active  Boolean? @default(true)
  created_at DateTime @default(now()) @db.Timestamp(0)
}

model blogs {
  id                 Int      @id @default(autoincrement())
  title              String   @db.VarChar(255)
  slug               String   @unique(map: "slug") @db.VarChar(255)
  content            String   @db.LongText
  featured_image_url String?  @db.VarChar(1024)
  author_id          Int?
  is_published       Boolean? @default(false)
  created_at         DateTime @default(now()) @db.Timestamp(0)
  users              users?   @relation(fields: [author_id], references: [id], onUpdate: Restrict, map: "blogs_ibfk_1")

  @@index([author_id], map: "author_id")
}

model courses {
  id            Int            @id @default(autoincrement())
  title         String         @db.VarChar(255)
  slug          String         @unique(map: "slug") @db.VarChar(255)
  description   String         @db.Text
  price         Decimal        @default(0.00) @db.Decimal(10, 2)
  thumbnail_url String?        @db.LongText
  author_id     Int?
  is_published  Boolean?       @default(false)
  created_at    DateTime       @default(now()) @db.Timestamp(0)
  users         users?         @relation(fields: [author_id], references: [id], onUpdate: Restrict, map: "courses_ibfk_1")
  payments      payments[]
  testimonials  testimonials[]

  @@index([author_id], map: "author_id")
}

model invoices {
  id             Int      @id @default(autoincrement())
  payment_id     Int      @unique(map: "payment_id")
  user_id        Int
  invoice_number String   @unique(map: "invoice_number") @db.VarChar(100)
  invoice_url    String?  @db.VarChar(1024)
  issued_at      DateTime @db.Date
  due_at         DateTime @db.Date
  created_at     DateTime @default(now()) @db.Timestamp(0)
  payments       payments @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "invoices_ibfk_1")
  users          users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "invoices_ibfk_2")

  @@index([user_id], map: "user_id")
}

model payments {
  id                 Int             @id @default(autoincrement())
  user_id            Int
  course_id          Int
  amount             Decimal         @db.Decimal(10, 2)
  status             payments_status @default(pending)
  payment_gateway    String          @db.VarChar(50)
  gateway_payment_id String          @unique(map: "gateway_payment_id") @db.VarChar(255)
  gateway_order_id   String?         @db.VarChar(255)
  created_at         DateTime        @default(now()) @db.Timestamp(0)
  updated_at         DateTime        @default(now()) @db.Timestamp(0)
  invoices           invoices?
  users              users           @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "payments_ibfk_1")
  courses            courses         @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "payments_ibfk_2")

  @@index([course_id], map: "course_id")
  @@index([user_id], map: "user_id")
}

model testimonials {
  id           Int      @id @default(autoincrement())
  user_id      Int?
  course_id    Int?
  rating       Int      @db.TinyInt
  comment      String   @db.Text
  is_approved  Boolean? @default(false)
  created_at   DateTime @default(now()) @db.Timestamp(0)
  author_name  String?  @db.VarChar(255)
  author_role  String?  @db.VarChar(255)
  author_image String?  @db.LongText
  users        users?   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "testimonials_ibfk_1")
  courses      courses? @relation(fields: [course_id], references: [id], onUpdate: Restrict, map: "testimonials_ibfk_2")

  @@index([course_id], map: "course_id")
  @@index([user_id], map: "user_id")
}

model users {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(255)
  email         String         @unique(map: "email") @db.VarChar(255)
  password_hash String         @db.VarChar(255)
  role          users_role     @default(student)
  created_at    DateTime       @default(now()) @db.Timestamp(0)
  blogs         blogs[]
  courses       courses[]
  invoices      invoices[]
  payments      payments[]
  testimonials  testimonials[]
}

enum payments_status {
  pending
  completed
  failed
}

enum users_role {
  student
  admin
}
